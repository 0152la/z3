pool:
  vmImage: "vs2017-win2016"


steps:

- script: git clone https://github.com/z3prover/bin bin
  
- task: DotNetCoreInstaller@0
  displayName: 'Use .NET Core sdk 2.1'
  inputs:
    version: 2.1.300

- task: DownloadSecureFile@1
  inputs:
    secureFile: 'z3.snk'

- script: dir

- script: "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\VC\Auxiliary\Build\vcvars64.bat"

- script: python scripts\mk_win_dist.py --x64-only --dotnet-key=$(Agent.TempDirectory)\z3.snk

#- script: "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\VC\Auxiliary\Build\vcvars32.bat"

#- script: python scripts\mk_win_dist.py --x86-only --dotnet-key=$(Agent.TempDirectory)\z3.snk

- script: dir
- script: dir dist
- script: xcopy dist\z3-4.8.6-x86-win\*.zip bin\nightly\* /y
- script: xcopy dist\z3-4.8.6-x64-win\*.zip bin\nightly\* /y
- script: cd bin\nightly
- script: git add *.zip
- script: git commit -s -a 
- script: git push


